<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"> 
<html> 
<head> 
	<title>Google Maps V3 test</title> 
	<meta http-equiv="content-type" content="text/html;charset=utf-8" /> 
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> 
	<script type="text/javascript"> 

		function GetQueryString() {
			if (1 < location.hash.length) {
				// クエリの区切り記号 (&) で文字列を配列に分割する
				var parameters = location.hash.slice(1).split('&');

				var result = new Object();
				for (var i = 0;i < parameters.length;i++) {
					// パラメータ名とパラメータ値に分割する
					var element = parameters[i].split('=');

					var paramName = decodeURIComponent(element[0]);
					var paramValue = decodeURIComponent(element[1]);

					// パラメータ名をキーとして連想配列に追加する
					result[paramName] = decodeURIComponent(paramValue);
				}
				return result;
			}
			return null;
		}

		google.maps.event.addDomListener(window, 'load', function()
		{
			document.getElementById('gmap').style.display = "none";
			var mapOptions = { 
				zoom: 12, 
				center: null, 
				mapTypeId: google.maps.MapTypeId.ROADMAP, 
				scaleControl: true
			};
			var mapObj = new google.maps.Map(document.getElementById('gmap'), mapOptions);


			var rendererOptions = {
				suppressMarkers : false,
				draggable: true
			};
			// ルートを表示するマップを設定 
			var directionsRenderer = new google.maps.DirectionsRenderer(rendererOptions);
			directionsRenderer.setMap(mapObj);

			var param = GetQueryString();
 
			if(!param|| !param['from'] || !param['to']){
				return;
			}
            var wayPoints = []; 

			// 経由地点を設定 
			if(param['way'] && (param['way'] != "")) {
				wayPoints = [{location: param['way']}];
			}


			// 開始地点と終了地点、ルーティングの種類の設定
			var request = {
				origin: param['from'], 
				destination: param['to'], 
				travelMode: google.maps.DirectionsTravelMode.WALKING, 
				waypoints: wayPoints 
			};


			// ルート検索を行う 
			var directionsService = new google.maps.DirectionsService();
			directionsService.route(request, function(result, status) 
			{ 
				if (status == google.maps.DirectionsStatus.OK) { 
					directionsRenderer.setDirections(result);
					document.getElementById('gmap').style.display = "";
				} 
			});
		});
// Usage:file:///M:/MyPrograms/santa/github/Brewfile/map/map.html#from=大金平5-369-12&way=鰭ヶ崎小学校&to=南流山駅
// URL http://maps.google.com/maps?saddr=現在地&daddr=東京駅&dirflg=w
	</script> 
</head> 
<body> 
	<div id="gmap" style="width: 99%;height: 370px;border: 1px solid Gray;"> 
	</div>
</body> 
</html> 